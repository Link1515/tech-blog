<!DOCTYPE html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Express 資安最佳實踐 | Lynk is here</title><meta name=description content="本文章參考 Express 官方文件中的 Production Best Practices: Security，逐項列出官方推薦的最佳實踐，確保我們在開發 Express 應用時，能有效的防範資安漏洞"><link rel=icon type=image/x-icon href=/images/favicon.ico><meta property=og:type content=website><meta property=og:url content=https://blog.lynkishere.us.kg><meta property=og:title content="Express 資安最佳實踐 | Lynk is here"><meta property=og:description content="本文章參考 Express 官方文件中的 Production Best Practices: Security，逐項列出官方推薦的最佳實踐，確保我們在開發 Express 應用時，能有效的防範資安漏洞"><meta property=og:image content=/images/cover/express.jpg><meta name=twitter:card content=summary_large_image><meta name=twitter:title content="Express 資安最佳實踐 | Lynk is here"><meta name=twitter:description content="本文章參考 Express 官方文件中的 Production Best Practices: Security，逐項列出官方推薦的最佳實踐，確保我們在開發 Express 應用時，能有效的防範資安漏洞"><meta name=twitter:image content=/images/cover/express.jpg><link rel=stylesheet href=/lib/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css><link rel=stylesheet href=/lib/prismjs/prism.min.css><link rel=stylesheet href=/lib/prismjs/prism-vsc-dark-plus.css><link rel=stylesheet href=/css/main.css><meta name=generator content="Hexo 7.3.0"></head><body data-bs-theme=dark><script>const theme=window.localStorage.getItem("theme")??"";document.body.dataset.bsTheme=theme</script><div class="min-vh-100 d-flex flex-column"><nav id=navbar class="navbar navbar-expand-lg bg-body-tertiary sticky-top shadow-sm"><div class=container-lg><a id=logo class=navbar-brand href=/ ><img class=me-1 src=/images/logo.png height=50 alt=logo> Lynk is here </a><button class="navbar-toggler px-2" type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent><i class="bi bi-list icon-20"></i></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav ms-auto mb-2 mb-lg-0"><li class=nav-item><a class=nav-link href=/ ><i class="bi bi-house-fill icon-20"></i> 首頁</a></li><li class=nav-item><a class=nav-link href=/archives><i class="bi bi-list-ul icon-20"></i> 列表</a></li><li class=nav-item><a class=nav-link href=/categories><i class="bi bi-folder-fill icon-20"></i> 分類</a></li><li class=nav-item><a class=nav-link href=/tags><i class="bi bi-tags-fill icon-20"></i> 標籤</a></li></ul><div class="d-flex justify-content-center"><button id=toggleThemeBtn class="toggleThemeBtn btn" style=border:none><i class="bi bi-lightbulb-fill icon-20"></i></button> <button id=searchBtn class="searchBtn btn" style=border:none data-bs-toggle=modal data-bs-target=#searchModal><i class="bi bi-search icon-20"></i></button></div></div></div></nav><div class="flex-grow-1 container-lg mt-4 mb-5"><div class=post><h1>Express 資安最佳實踐</h1><small class=text-body-secondary><time datetime=2024-03-10T06:46:49.000Z>2024-03-10</time></small><hr><div class="d-flex flex-column gap-2 mb-4"><div><div class="d-flex flex-wrap gap-2"><a href=/categories/Backend/ class="btn btn-secondary btn-sm"><i class="bi bi-folder-fill icon-15"></i> Backend</a></div></div><div><div class="tagLinks d-flex flex-wrap gap-2"><a href=/tags/Express/ class="btn btn-secondary btn-sm"><i class="bi bi-tag-fill icon-15"></i> Express</a></div></div></div><div class="text-center mb-4"><img class="img-fluid rounded" width=1200 height=630 src=/images/cover/express.jpg alt=cover></div><div class=content><p>本文章參考 Express 官方文件中的 Production Best Practices: Security，逐項列出官方推薦的最佳實踐，確保我們在開發 Express 應用時，能有效的防範資安漏洞</p><blockquote><p>官方原文: <a target=_blank rel=noopener href=https://expressjs.com/en/advanced/best-practice-security.html>Production Best Practices: Security</a></p></blockquote><h2 id=不使用棄用或有資安問題的-Express-版本><a href=#不使用棄用或有資安問題的-Express-版本 class=headerlink title="不使用棄用或有資安問題的 Express 版本"></a>不使用棄用或有資安問題的 Express 版本</h2><ul><li>Express 4 以下的版本已經不再維護，盡量避免使用。要升級到版本 4 可以參考 <a target=_blank rel=noopener href=https://expressjs.com/en/guide/migrating-4.html>Moving to Express 4</a></li><li>也避免使用有資安問題的版本，可以參考 <a target=_blank rel=noopener href=https://expressjs.com/en/advanced/security-updates.html>Security updates</a></li></ul><h2 id=使用-TLS><a href=#使用-TLS class=headerlink title="使用 TLS"></a>使用 TLS</h2><ul><li>使用 <code>TLS(Transport Layer Security)</code> 來進行連線與資料傳輸</li><li>在網頁瀏覽上即為使用 <code>https</code> 協議</li><li>可以防止網路封包被監聽 (packet sniffing) 或 中間人攻擊 (man-in-the-middle attacks)</li><li>如果本來是使用 <code>SSL</code> 建議升級為 <code>TLS</code></li><li>可以使用由 Internet Security Research Group (ISRG) 提供的 Let’s Encrypt 取的免費的 <code>TLS</code> 憑證</li></ul><h2 id=使用-helmet-套件><a href=#使用-helmet-套件 class=headerlink title="使用 helmet 套件"></a>使用 helmet 套件</h2><ul><li><a target=_blank rel=noopener href=https://helmetjs.github.io/ >Helmet</a> 套件是由許多 Express middleware 組成，透過設置 HTTP header 來防範一些常見的網頁資安漏洞。如以下範例</li><li><code>helmet.contentSecurityPolicy</code> 設置了 <code>Content-Security-Policy</code> 來避免跨站腳本攻擊(XSS)</li><li><code>helmet.hsts</code> 設置了 <code>Strict-Transport-Security</code> 來確保使用 HTTPS 連線</li><li><code>helmet.frameguard</code> 設置了 <code>X-Frame-Options</code> 防範點擊劫持(clickjacking)</li></ul><p>安裝與使用</p><pre class=language-JavaScript data-language=JavaScript><code class=language-JavaScript>&#x2F;&#x2F; ...

const helmet &#x3D; require(&#39;helmet&#39;);
app.use(helmet());

&#x2F;&#x2F; ...</code></pre><h2 id=禁用-X-Powered-By-header><a href=#禁用-X-Powered-By-header class=headerlink title="禁用 X-Powered-By header"></a>禁用 X-Powered-By header</h2><ul><li>盡量避免暴露伺服器資訊</li><li><code>helmet</code> 套件已經幫我們做了，使用後就會直接禁用 <code>X-Powered-By</code></li></ul><pre class=language-JavaScript data-language=JavaScript><code class=language-JavaScript>app.disable(&#39;x-powered-by&#39;);</code></pre><h2 id=適當的使用-cookie><a href=#適當的使用-cookie class=headerlink title="適當的使用 cookie"></a>適當的使用 cookie</h2><ul><li>使用 <a target=_blank rel=noopener href=https://www.npmjs.com/package/express-session>express-session</a> 或 <a target=_blank rel=noopener href=https://www.npmjs.com/package/cookie-session>cookie-session</a></li><li><code>express-session</code><ul><li>取代 Express 3.x 中的 <code>express.session</code></li><li>此套件將資料存放於 server，<code>cookie</code> 上只會帶 <code>session ID</code></li><li>套件預設使用 in-memory storage，此方法並不適合用在正式環境，要在正式環境使用需要設定 <code>session-store</code>，可以參考 <a target=_blank rel=noopener href=https://github.com/expressjs/session#compatible-session-stores>compatible session stores</a></li></ul></li><li><code>cookie-session</code><ul><li>取代 Express 3.x 中的 <code>express.cookieSession</code></li><li>實踐了 <code>cookie-backed storage</code> 將整個資料都存在 <code>cookie</code></li><li>僅建議於資料量小且易於加密時使用</li><li>資料建議為基本型別 (<code>string</code>, <code>number</code>, <code>boolean</code>, <code>null</code>, <code>undefined</code>)，避免為物件 (<code>Object</code>)</li><li>要注意 <code>cookie</code> 上的資料是可以被 client side 看到的，如果有不能被 client side 看到資料的考量，可以改用 <code>express-session</code></li></ul></li><li>避免使用預設的 <code>cookie</code> 名稱。以下為使用 <code>express-session</code> 的範例</li></ul><pre class=language-JavaScript data-language=JavaScript><code class=language-JavaScript>const session &#x3D; require(&#39;express-session&#39;);
app.set(&#39;trust proxy&#39;, 1); &#x2F;&#x2F; trust first proxy
app.use(
  session(&#123;
    secret: &#39;s3Cur3&#39;,
    name: &#39;sessionId&#39;
  &#125;)
);</code></pre><ul><li>設定 <code>cookie</code> 的安全配置<ul><li><code>secure</code>: 只有在 <code>HTTPS</code> 連線時才會送 <code>cookie</code></li><li><code>httpOnly</code>: 只有在 <code>HTTP(S)</code> 傳輸時才可以訪問到 <code>cookie</code>，用戶端的 JavaScript 無法取得到 <code>cookie</code></li><li><code>domain</code>: 設定 <code>cookie</code> 的 <code>domain</code></li><li><code>path</code>: 設定 <code>cookie</code> 的 <code>path</code></li><li><code>expires</code>: 設定 <code>cookie</code> 的過期時間</li></ul></li></ul><h2 id=禁止暴力猜測密碼><a href=#禁止暴力猜測密碼 class=headerlink title=禁止暴力猜測密碼></a>禁止暴力猜測密碼</h2><ul><li>限制同一個用戶和 IP 連續嘗試登入失敗的次數，ex: 用戶連續登入失敗 5 次就要等 5 分鐘才可以再次嘗試</li><li>限制 IP 地址在某個長時間內允許失敗的次數，ex: 一個 IP 每天只能登入失敗 100 次</li><li>可以使用 <a target=_blank rel=noopener href=https://github.com/animir/node-rate-limiter-flexible>rate-limiter-flexible</a> 套件</li></ul><h2 id=確保安裝的套件都是安全的><a href=#確保安裝的套件都是安全的 class=headerlink title=確保安裝的套件都是安全的></a>確保安裝的套件都是安全的</h2><ul><li>npm 6 以後可以使用 <code>npm audit</code> 來分析套件</li><li>如果需要更好的分析，可以使用 <a target=_blank rel=noopener href=https://snyk.io/ >Snyk</a></li></ul><h2 id=避免其他已知的資安漏洞><a href=#避免其他已知的資安漏洞 class=headerlink title=避免其他已知的資安漏洞></a>避免其他已知的資安漏洞</h2><ul><li>關注 <a target=_blank rel=noopener href=https://github.com/advisories>Node Security Project</a> 與 <a target=_blank rel=noopener href=https://security.snyk.io/ >Snyk</a> 的資安建議，這些都是很好的資源</li><li>了解常見的資安漏洞，並避免發生這些資安問題</li></ul><h2 id=其他><a href=#其他 class=headerlink title=其他></a>其他</h2><p>以下來自 Node.js Security Checklist 的建議</p><ul><li>永遠都要過濾用戶的輸入，避免 <code>cross-site scripting (XSS)</code> 與 <code>command injection attacks</code></li><li>透過參數化查詢 (parameterized queries) 與準備語句 (prepared statements) 來避免 <code>SQL injection attacks</code></li><li>使用開源工具 <code>sqlmap</code> 來檢測 <code>SQL injection</code> 的問題</li><li>使用 <code>nmap</code> 與 <code>sslyze</code> 工具檢測 <code>SSL ciphers</code>, <code>keys</code>, and <code>renegotiation</code> 與憑證的有效性</li><li>使用 <code>safe-regex</code> 確保正則表達式不會受到 <code>regular expression denial of service attacks</code></li></ul></div></div></div><footer class="footer border-top text-center py-3"><div class="container-lg text-body-secondary">© Copyright 2024 By Terry Lin</div></footer></div><div class="modal fade" id=searchModal tabindex=-1><div class=modal-dialog><div class=modal-content><div class=modal-body><div class="position-relative mb-3"><input id=searchInput class=form-control type=search style=padding-left:2.25rem> <span class="position-absolute top-50 translate-middle-y search-icon" style=left:.75rem><i class="bi bi-search"></i></span></div><div id=searchResults class="list-group list-group-flush"></div><div id=searchNoResult class="list-group list-group-flush" style=display:none><span class=list-group-item>查無結果</span></div></div></div></div></div><div class=goTopBtn><button id=goTopBtn class=shadow-sm><i class="bi bi-chevron-up"></i></button></div><script src=/lib/bootstrap/bootstrap.bundle.min.js></script><script src=/lib/prismjs/prism.min.js></script><script src=/lib/fuse/fuse.js></script><script src=/js/utils.js></script><script src=/js/main.js type=module></script></body></html>